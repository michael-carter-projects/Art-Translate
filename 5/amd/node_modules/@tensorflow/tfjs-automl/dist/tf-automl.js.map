{"version":3,"file":"tf-automl.js","sources":["../src/util.ts","../src/img_classification.ts","../src/object_detection.ts","../src/version.ts","../src/index.ts"],"sourcesContent":["/**\n * @license\n * Copyright 2019 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {browser, Tensor, Tensor3D, util} from '@tensorflow/tfjs-core';\nimport {ImageInput} from './types';\n\nexport function imageToTensor(img: ImageInput): Tensor3D {\n  return img instanceof Tensor ? img : browser.fromPixels(img);\n}\n\n/** Loads and parses the dictionary. */\nexport async function loadDictionary(modelUrl: string): Promise<string[]> {\n  const lastIndexOfSlash = modelUrl.lastIndexOf('/');\n  const prefixUrl =\n      lastIndexOfSlash >= 0 ? modelUrl.slice(0, lastIndexOfSlash + 1) : '';\n  const dictUrl = `${prefixUrl}dict.txt`;\n  const response = await util.fetch(dictUrl);\n  const text = await response.text();\n  return text.trim().split('\\n');\n}\n","/**\n * @license\n * Copyright 2019 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {GraphModel, loadGraphModel} from '@tensorflow/tfjs-converter';\nimport {cast, div, expandDims, image, sub, Tensor, Tensor3D, Tensor4D, tidy} from '@tensorflow/tfjs-core';\n\nimport {ImageInput} from './types';\nimport {imageToTensor, loadDictionary} from './util';\n\nexport interface ImagePrediction {\n  prob: number;\n  label: string;\n}\n\nexport interface ImageClassificationOptions {\n  centerCrop: boolean;\n}\n\n/** Input size as expected by the model. */\nconst IMG_SIZE: [number, number] = [224, 224];\n// Constants used to normalize the image between -1 and 1.\nconst DIV_FACTOR = 127.5;\nconst SUB_FACTOR = 1;\n\nexport class ImageClassificationModel {\n  constructor(public graphModel: GraphModel, public dictionary: string[]) {}\n\n  async classify(input: ImageInput, options?: ImageClassificationOptions):\n      Promise<ImagePrediction[]> {\n    options = sanitizeOptions(options);\n\n    const scores = tidy(() => {\n      const preprocessedImg = this.preprocess(input, options);\n      return this.graphModel.predict(preprocessedImg) as Tensor;\n    });\n    const probabilities = await scores.data() as Float32Array;\n    scores.dispose();\n    const result = Array.from(probabilities)\n                       .map((prob, i) => ({label: this.dictionary[i], prob}));\n    return result;\n  }\n\n  private preprocess(input: ImageInput, options: ImageClassificationOptions) {\n    // Preprocessing involves center crop and normalizing between [-1, 1].\n    const img = imageToTensor(input);\n    const croppedImg = options.centerCrop ?\n        centerCropAndResize(img) :\n        expandDims(image.resizeBilinear(img, IMG_SIZE));\n    return sub(div(croppedImg, DIV_FACTOR), SUB_FACTOR);\n  }\n}\n\nexport async function loadImageClassification(modelUrl: string):\n    Promise<ImageClassificationModel> {\n  const [model, dict] =\n      await Promise.all([loadGraphModel(modelUrl), loadDictionary(modelUrl)]);\n  return new ImageClassificationModel(model, dict);\n}\n\nfunction sanitizeOptions(options: ImageClassificationOptions) {\n  options = options || {} as ImageClassificationOptions;\n  if (options.centerCrop == null) {\n    options.centerCrop = true;\n  }\n  return options;\n}\n\n/** Center crops an image */\nfunction centerCropAndResize(img: Tensor3D) {\n  return tidy(() => {\n    const [height, width] = img.shape.slice(0, 2);\n    let top = 0;\n    let left = 0;\n    if (height > width) {\n      top = (height - width) / 2;\n    } else {\n      left = (width - height) / 2;\n    }\n    const size = Math.min(width, height);\n    const boxes = [\n      [top / height, left / width, (top + size) / height, (left + size) / width]\n    ];\n    const boxIndices = [0];\n    return image.cropAndResize(\n        // tslint:disable-next-line\n        expandDims(cast(img, 'float32')) as Tensor4D, boxes, boxIndices,\n        IMG_SIZE);\n  });\n}\n","/**\n * @license\n * Copyright 2019 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {GraphModel, loadGraphModel} from '@tensorflow/tfjs-converter';\nimport {cast, dispose, expandDims, image, Tensor, Tensor2D, tidy} from '@tensorflow/tfjs-core';\n\nimport {ImageInput} from './types';\nimport {imageToTensor, loadDictionary} from './util';\n\nconst DEFAULT_TOPK = 20;\nconst DEFAULT_IOU_THRESHOLD = 0.5;\nconst DEFAULT_SCORE_THRESHOLD = 0.5;\n\nconst INPUT_NODE_NAME = 'ToFloat';\nconst OUTPUT_NODE_NAMES =\n    ['Postprocessor/convert_scores', 'Postprocessor/Decode/transpose_1'];\n\nexport interface ObjectDetectionOptions {\n  /**\n   * Only the `topk` most likely objects are returned. The actual number of\n   * objects might be less than this number.\n   */\n  topk?: number;\n  /**\n   * Intersection over union threshold. IoU is a metric between 0 and 1 used to\n   * measure the overlap of two boxes. The predicted boxes will not overlap more\n   * than the specified threshold.\n   */\n  iou?: number;\n  /** Boxes with score lower than this threshold will be ignored. */\n  score?: number;\n}\n\n/** Contains the coordinates of a bounding box. */\nexport interface Box {\n  /** Number of pixels from the top of the image (top padding). */\n  top: number;\n  /** Number of pixels from the left of the image (left padding). */\n  left: number;\n  /** The width of the box. */\n  width: number;\n  /** The height of the box. */\n  height: number;\n}\n\n/** The predicted object, which holds the score, label and bounding box. */\nexport interface PredictedObject {\n  box: Box;\n  score: number;\n  label: string;\n}\n\nexport class ObjectDetectionModel {\n  constructor(public graphModel: GraphModel, public dictionary: string[]) {}\n\n  async detect(input: ImageInput, options?: ObjectDetectionOptions):\n      Promise<PredictedObject[]> {\n    options = sanitizeOptions(options);\n    const img = tidy(() => this.preprocess(input, options));\n    const [height, width] = [img.shape[1], img.shape[2]];\n    const feedDict: {[name: string]: Tensor} = {};\n    feedDict[INPUT_NODE_NAME] = img;\n    const [scoresTensor, boxesTensor] =\n        await this.graphModel.executeAsync(feedDict, OUTPUT_NODE_NAMES) as\n        Tensor[];\n\n    const [, numBoxes, numClasses] = scoresTensor.shape;\n    const [scores, boxes] =\n        await Promise.all([scoresTensor.data(), boxesTensor.data()]);\n    const {boxScores, boxLabels} =\n        calculateMostLikelyLabels(scores as Float32Array, numBoxes, numClasses);\n\n    // Sort the boxes by score, ignoring overlapping boxes.\n    const selectedBoxesTensor = await image.nonMaxSuppressionAsync(\n        boxesTensor as Tensor2D, boxScores, options.topk, options.iou,\n        options.score);\n    const selectedBoxes = await selectedBoxesTensor.data() as Int32Array;\n    dispose([img, scoresTensor, boxesTensor, selectedBoxesTensor]);\n\n    const result = buildDetectedObjects(\n        width, height, boxes as Float32Array, boxScores, boxLabels,\n        selectedBoxes, this.dictionary);\n    return result;\n  }\n\n  private preprocess(input: ImageInput, options: ObjectDetectionOptions) {\n    return cast(expandDims(imageToTensor(input)), 'float32');\n  }\n}\n\nexport async function loadObjectDetection(modelUrl: string):\n    Promise<ObjectDetectionModel> {\n  const [model, dict] =\n      await Promise.all([loadGraphModel(modelUrl), loadDictionary(modelUrl)]);\n  return new ObjectDetectionModel(model, dict);\n}\n\nfunction sanitizeOptions(options: ObjectDetectionOptions) {\n  options = options || {} as ObjectDetectionOptions;\n  if (options.topk == null) {\n    options.topk = DEFAULT_TOPK;\n  }\n  if (options.iou == null) {\n    options.iou = DEFAULT_IOU_THRESHOLD;\n  }\n  if (options.score == null) {\n    options.score = DEFAULT_SCORE_THRESHOLD;\n  }\n  return options;\n}\n\nfunction calculateMostLikelyLabels(\n    scores: Float32Array, numBoxes: number,\n    numClasses: number): {boxScores: number[], boxLabels: number[]} {\n  // Holds a score for each box.\n  const boxScores: number[] = [];\n  // Holds the label id for each box.\n  const boxLabels: number[] = [];\n  for (let i = 0; i < numBoxes; i++) {\n    let maxScore = Number.MIN_VALUE;\n    let mostLikelyLabel = -1;\n    for (let j = 0; j < numClasses; j++) {\n      const flatIndex = i * numClasses + j;\n      const score = scores[flatIndex];\n      if (score > maxScore) {\n        maxScore = scores[flatIndex];\n        mostLikelyLabel = j;\n      }\n    }\n    boxScores[i] = maxScore;\n    boxLabels[i] = mostLikelyLabel;\n  }\n  return {boxScores, boxLabels};\n}\n\nfunction buildDetectedObjects(\n    width: number, height: number, boxes: Float32Array, boxScores: number[],\n    boxLabels: number[], selectedBoxes: Int32Array,\n    dictionary: string[]): PredictedObject[] {\n  const objects: PredictedObject[] = [];\n  // Each 2d rectangle is fully described with 4 coordinates.\n  const numBoxCoords = 4;\n  for (let i = 0; i < selectedBoxes.length; i++) {\n    const boxIndex = selectedBoxes[i];\n    const [top, left, bottom, right] = Array.from(boxes.slice(\n        boxIndex * numBoxCoords, boxIndex * numBoxCoords + numBoxCoords));\n    objects.push({\n      box: {\n        left: left * width,\n        top: top * height,\n        width: (right - left) * width,\n        height: (bottom - top) * height,\n      },\n      label: dictionary[boxLabels[boxIndex]],\n      score: boxScores[boxIndex],\n    });\n  }\n  return objects;\n}\n","/** @license See the LICENSE file. */\n\n// This code is auto-generated, do not modify this file!\nconst version = '1.2.0';\nexport {version};\n","/**\n * @license\n * Copyright 2019 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\n// Image classification API.\nexport {ImageClassificationModel, ImageClassificationOptions, ImagePrediction, loadImageClassification} from './img_classification';\n// Object detection API.\nexport {Box, loadObjectDetection, ObjectDetectionModel, ObjectDetectionOptions, PredictedObject} from './object_detection';\n\n// Shared API.\nexport {ImageInput} from './types';\nexport {version} from './version';\n"],"names":["Tensor","browser","util","tidy","expandDims","image","sub","div","loadGraphModel","cast","sanitizeOptions","dispose"],"mappings":"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"}